# ğŸ“„ PDF FÃ¡cil â€” API + Web App

**PDF FÃ¡cil** Ã© uma ferramenta gratuita que permite **unir, comprimir e organizar arquivos PDF e imagens (JPG/PNG)** diretamente do navegador.  
Nenhum dado Ã© salvo: tudo acontece **em memÃ³ria**, e os arquivos sÃ£o apagados automaticamente apÃ³s alguns minutos.

---

## ğŸŒ Site oficial

ğŸ”— **Acesse o app web:**  
ğŸ‘‰ [https://romanbrocki.github.io/PDF_Facil_API/](https://romanbrocki.github.io/PDF_Facil_API/)

O site se comunica com o backend hospedado no Render:  
ğŸ”§ [https://pdf-facil.onrender.com](https://pdf-facil.onrender.com)

---

## ğŸ§© Como o sistema funciona

O projeto Ã© dividido em duas partes:

| Parte | Hospedagem | DescriÃ§Ã£o |
|-------|-------------|------------|
| **Frontend (index.html)** | GitHub Pages | Interface web feita em HTML + JavaScript. Envia arquivos e recebe o PDF pronto. |
| **Backend (FastAPI)** | Render | API em Python que faz o trabalho pesado (compressÃ£o, merge e geraÃ§Ã£o do arquivo final). |

---

## âš™ï¸ Estrutura do Projeto

```
PDF_Facil_API/
â”œâ”€ api/
â”‚  â”œâ”€ main.py          # Endpoints e lÃ³gica principal
â”‚  â”œâ”€ storage.py       # SessÃµes em memÃ³ria (RAM + tempo de vida)
â”‚  â”œâ”€ thumbs.py        # GeraÃ§Ã£o de miniaturas
â”‚  â”œâ”€ schemas.py       # Modelos de entrada/saÃ­da
â”‚  â””â”€ jobs.py          # GeraÃ§Ã£o e exclusÃ£o dos PDFs finais
â”œâ”€ engine/
â”‚  â”œâ”€ engine_config.py # Presets de compressÃ£o
â”‚  â””â”€ pdf_ops.py       # FunÃ§Ãµes de compressÃ£o, uniÃ£o e rotaÃ§Ã£o
â”œâ”€ index.html          # Interface Web
â”œâ”€ requirements.txt    # DependÃªncias Python
â”œâ”€ runtime.txt         # VersÃ£o Python usada no Render
â””â”€ DOCS.md             # DocumentaÃ§Ã£o tÃ©cnica complementar
```

---

## ğŸš€ Fluxo completo

```text
1. UsuÃ¡rio envia arquivos â†’ /preview
2. API gera miniaturas e devolve token
3. UsuÃ¡rio define ordem, rotaÃ§Ã£o e compressÃ£o
4. App envia tudo â†’ /estimate (opcional)
5. API estima tamanho final e mostra reduÃ§Ã£o
6. App envia â†’ /process
7. API gera PDF e devolve link temporÃ¡rio
8. UsuÃ¡rio baixa o arquivo â†’ /download/one-time/{job_id}
```

O **token** identifica temporariamente a sessÃ£o (fica em memÃ³ria).  
O **job_id** identifica o PDF final (tambÃ©m em memÃ³ria, atÃ© o download).

---

## ğŸ“¦ NÃ­veis de compressÃ£o

| NÃ­vel | Efeito | Uso indicado |
|-------|---------|---------------|
| **none** | sem compressÃ£o | preservar qualidade mÃ¡xima |
| **min** | leve compressÃ£o (rasteriza sÃ³ imagens) | documentos mistos |
| **med** | compressÃ£o moderada (rasteriza tudo) | PDFs pesados |
| **max** | compressÃ£o mÃ¡xima | reduzir ao mÃ­nimo possÃ­vel |

---

## ğŸ§ª Exemplos de uso da API

### ğŸ”¹ Upload e preview
```bash
curl -X POST -F "files=@documento.pdf" https://pdf-facil.onrender.com/preview
```

Retorno (resumo):
```json
{
  "token": "abc123",
  "page_count_total": 12,
  "items": [
    {"src_id":0,"page_index":0,"is_pdf":true,"thumb_b64":"data:image/jpeg;base64,..."} 
  ]
}
```

### ğŸ”¹ Estimar tamanho
```bash
curl -X POST https://pdf-facil.onrender.com/estimate      -H "Content-Type: application/json"      -d '{
          "token":"abc123",
          "order":[{"src_id":0,"page_index":0}],
          "keep":[true],
          "rotate":[0],
          "level_page":["med"]
         }'
```

### ğŸ”¹ Gerar PDF final
```bash
curl -X POST https://pdf-facil.onrender.com/process      -H "Content-Type: application/json"      -d '{
          "token":"abc123",
          "order":[{"src_id":0,"page_index":0}],
          "keep":[true],
          "rotate":[0],
          "level_page":["med"],
          "filename_out":"resultado.pdf"
         }'
```

Resposta:
```json
{
  "download_url": "/download/one-time/xyz789",
  "filename": "resultado.pdf"
}
```

---

### ğŸ”¸ Exemplo JavaScript (`fetch`)
```js
const payload = { token, order, keep, rotate, level_page, filename_out: "meu_arquivo.pdf" };

const res = await fetch("https://pdf-facil.onrender.com/process", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(payload)
});

const data = await res.json();
window.location.href = "https://pdf-facil.onrender.com" + data.download_url;
```

---

## âš ï¸ Erros comuns

| Mensagem | Causa | SoluÃ§Ã£o |
|-----------|--------|---------|
| **SessÃ£o expirada (404)** | Passaram mais de 15 minutos sem uso | Refazer upload e gerar novo token |
| **job nÃ£o encontrado/expirado** | O PDF jÃ¡ foi baixado ou o TTL expirou | Gerar novamente |
| **Arquivo excede X MB** | Tamanho maior que permitido por `FILE_MAX_MB` | Enviar arquivo menor ou aumentar variÃ¡vel no backend |
| **CORS error (bloqueio no navegador)** | DomÃ­nio do frontend nÃ£o estÃ¡ autorizado | Adicionar domÃ­nio em `CORS_ALLOW_ORIGINS` |

---

## ğŸ”§ ConfiguraÃ§Ã£o do backend (Render)

```env
FILE_MAX_MB=50
BATCH_MAX_MB=75
TTL_MINUTES=15
CORS_ALLOW_ORIGINS=https://romanbrocki.github.io,https://romanbrocki.github.io/PDF_Facil_API/
```

Comando de inicializaÃ§Ã£o:
```bash
uvicorn api.main:app --host 0.0.0.0 --port $PORT
```

---

## ğŸ’» ExecuÃ§Ã£o local

```bash
pip install -r requirements.txt
uvicorn api.main:app --reload
```

Acesse: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)

---

## ğŸ§  Tecnologias utilizadas

| Componente | Biblioteca |
|-------------|-------------|
| Backend | FastAPI, Uvicorn |
| PDF | PyMuPDF, Pillow, img2pdf, pypdf |
| Frontend | HTML + JavaScript puro |
| Hospedagem | Render + GitHub Pages |

---

## ğŸ”’ SeguranÃ§a e privacidade

- Nenhum arquivo Ã© salvo no servidor.  
- Tudo Ã© mantido **em memÃ³ria temporÃ¡ria**.  
- Os links de download sÃ£o vÃ¡lidos **uma Ãºnica vez**.  
- As sessÃµes e arquivos expiram automaticamente apÃ³s o tempo configurado (`TTL_MINUTES`, padrÃ£o 15).  

---

## ğŸ”— Links oficiais

- ğŸŒ **App Web:** [https://romanbrocki.github.io/PDF_Facil_API/](https://romanbrocki.github.io/PDF_Facil_API/)  
- âš™ï¸ **Backend:** [https://pdf-facil.onrender.com](https://pdf-facil.onrender.com)  
- ğŸ’» **RepositÃ³rio:** [https://github.com/RomanBrocki/PDF_Facil_API](https://github.com/RomanBrocki/PDF_Facil_API)  
- ğŸ§± **VersÃ£o antiga (Streamlit):** [https://pdf-facil.streamlit.app](https://pdf-facil.streamlit.app)

---

## ğŸ‘¨â€ğŸ’» Autor

Desenvolvido por **Roman Brocki**  
Backend em Python â€¢ Frontend em HTML/JS  
Hospedagem gratuita no **Render** e **GitHub Pages**


---

## LicenÃ§as e CrÃ©ditos

Este projeto utiliza bibliotecas open source sob licenÃ§as permissivas.  
Em especial, inclui o **PyMuPDF**, distribuÃ­do sob licenÃ§a **AGPL-3.0**.

- **PyMuPDF (AGPL-3.0)** â€” Â© Artifex Software, Inc.  
  Uso permitido em software aberto; este projeto mantÃ©m seu cÃ³digo-fonte pÃºblico conforme os termos da AGPL.  
- **Demais bibliotecas** (FastAPI, Pillow, Pydantic, Uvicorn, etc.) â€” sob licenÃ§as MIT, BSD ou Apache 2.0, livres para uso comercial.

O cÃ³digo-fonte completo deste projeto estÃ¡ disponÃ­vel publicamente, cumprindo todas as exigÃªncias de licenciamento.
